(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9522],{55583:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chat/users",function(){return n(46049)}])},37926:function(e,t,n){"use strict";n.d(t,{e:function(){return d}});var s=n(85893),r=n(85402),a=n(71577),l=n(21640),o=n(82911),i=n(84674),c=n(64777);let d=e=>{let{user:t,isEnabled:n,label:d,onClick:u}=e;async function m(e){let{id:t}=e;try{let s=await (0,c.rQ)(c.NM,{data:{userId:t,enabled:!n},method:"POST",auth:!0});return s.success}catch(r){console.error(r)}return!1}let h=n?"ban":"unban",x=n?(0,s.jsx)(l.Z,{style:{color:"var(--ant-error)"}}):(0,s.jsx)(o.Z,{style:{color:"var(--ant-warning)"}}),j=(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to ",h," ",(0,s.jsx)("strong",{children:t.displayName}),n?" and remove their messages?":"?"]}),y=()=>{r.Z.confirm({title:"Confirm ".concat(h),content:j,onCancel(){},onOk:()=>new Promise((e,n)=>{let s=m(t);s?setTimeout(()=>{e(s),null==u||u()},3e3):n()}),okType:"danger",okText:n?"Absolutely":null,icon:x})};return(0,s.jsx)(a.Z,{onClick:y,size:"small",icon:n?(0,s.jsx)(i.Z,{twoToneColor:"#ff4d4f"}):null,className:"block-user-button",children:d||h})};d.defaultProps={label:"",onClick:null}},17388:function(e,t,n){"use strict";n.d(t,{Z:function(){return A}});var s=n(85893),r=n(67294),a=n(94199),l=n(85402),o=n(84485),i=n(25968),c=n(6226),d=n(27049),u=n(26713),m=n(45938),h=n(58091),x=n(96486),j=n(37926),y=n(71577),g=n(21640),p=n(82911),f=n(84674),b=n(24478),w=n(64777);let k=e=>{var t;let{user:n,onClick:r}=e;async function a(e,t){let{id:n}=e;try{let s=await (0,w.rQ)(w.jr,{data:{userId:n,isModerator:t},method:"POST",auth:!0});return s.success}catch(r){console.error(r)}return!1}let o=null===(t=n.scopes)||void 0===t?void 0:t.includes("MODERATOR"),i=o?"remove moderator":"add moderator",c=o?(0,s.jsx)(g.Z,{style:{color:"var(--ant-error)"}}):(0,s.jsx)(p.Z,{style:{color:"var(--ant-warning)"}}),d=(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to ",i," ",(0,s.jsx)("strong",{children:n.displayName}),"?"]}),u=()=>{l.Z.confirm({title:"Confirm ".concat(i),content:d,onCancel(){},onOk:()=>new Promise((e,t)=>{let s=a(n,!o);s?setTimeout(()=>{e(s),null==r||r()},3e3):t()}),okType:"danger",okText:o?"Yup!":null,icon:c})};return(0,s.jsx)(y.Z,{onClick:u,size:"small",icon:o?(0,s.jsx)(f.Z,{twoToneColor:"#ff4d4f"}):(0,s.jsx)(b.Z,{twoToneColor:"#22bb44"}),className:"block-user-button",children:i})};k.defaultProps={onClick:null};var C=n(55709),N=n(70241);let A=e=>{let{user:t,connectionInfo:n,children:y}=e,[g,p]=(0,r.useState)(!1),f=()=>{p(!0)},b=()=>{p(!1)},{displayName:w,createdAt:A,previousNames:Z,nameChangedAt:v,disabledAt:T}=t,{connectedAt:D,messageCount:I,userAgent:P}=n||{},S=null,O=Z&&[...Z];Z&&Z.length>1&&v&&(S=new Date(v),O.reverse());let _=new Date(A),E=(0,h.Z)(_,"PP pp"),M=S?(0,m.Z)(S):null;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.Z,{title:(0,s.jsxs)(s.Fragment,{children:["Created at: ",E,".",(0,s.jsx)("br",{})," Click for more info."]}),placement:"bottomLeft",children:(0,s.jsx)("button",{type:"button","aria-label":"Display more details about this user",className:"user-item-container",onClick:f,children:y})}),(0,s.jsx)(l.Z,{destroyOnClose:!0,width:600,cancelText:"Close",okButtonProps:{style:{display:"none"}},title:"User details: ".concat(w),open:g,onOk:b,onCancel:b,children:(0,s.jsxs)("div",{className:"user-details",children:[(0,s.jsx)(o.Z.Title,{level:4,children:w}),(0,s.jsxs)("p",{className:"created-at",children:["User created at ",E,"."]}),(0,s.jsxs)(i.Z,{gutter:16,children:[n&&(0,s.jsxs)(c.Z,{md:S?12:24,children:[(0,s.jsx)(o.Z.Title,{level:5,children:"This user is currently connected to Chat."}),(0,s.jsxs)("ul",{className:"connection-info",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Active for:"})," ",(0,m.Z)(new Date(D))]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Messages sent:"})," ",I]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"User Agent:"}),(0,s.jsx)("br",{}),(0,N.AB)(P)]})]})]}),S&&(0,s.jsxs)(c.Z,{md:n?12:24,children:[(0,s.jsx)(o.Z.Title,{level:5,children:"This user is also seen as:"}),(0,s.jsx)("ul",{className:"previous-names-list",children:(0,x.uniq)(O).map((e,t)=>(0,s.jsxs)("li",{className:0===t?"latest":"",children:[(0,s.jsx)("span",{className:"user-name-item",children:e}),0===t?" (Changed ".concat(M," ago)"):""]}))})]})]}),(0,s.jsx)(d.Z,{}),(0,s.jsxs)(u.Z,{direction:"horizontal",children:[T?(0,s.jsxs)(s.Fragment,{children:["This user was banned on ",(0,s.jsx)("code",{children:(0,C.u)(T)}),".",(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(j.e,{label:"Unban this user",user:t,isEnabled:!1,onClick:b})]}):(0,s.jsx)(j.e,{label:"Ban this user",user:t,isEnabled:!0,onClick:b}),(0,s.jsx)(k,{user:t,onClick:b})]})]})})]})};A.defaultProps={connectionInfo:null}},55709:function(e,t,n){"use strict";n.d(t,{K:function(){return c},u:function(){return i}});var s=n(85893),r=n(93626),a=n(58091),l=n(17388),o=n(37926);function i(e){return(0,a.Z)(new Date(e),"MMM d H:mma")}let c=e=>{let{data:t}=e;return(0,s.jsx)(r.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:[{title:"Last Known Display Name",dataIndex:"displayName",key:"displayName",render:(e,t)=>(0,s.jsx)(l.Z,{user:t,children:(0,s.jsx)("span",{className:"display-name",children:e})})},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>i(e),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"Disabled at",dataIndex:"disabledAt",key:"disabledAt",defaultSortOrder:"descend",render:e=>e?i(e):null,sorter:(e,t)=>new Date(e.disabledAt).getTime()-new Date(t.disabledAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,s.jsx)(o.e,{user:t,isEnabled:!t.disabledAt})}],dataSource:t,size:"small",rowKey:"id"})}},46049:function(e,t,n){"use strict";n.r(t),n.d(t,{FETCH_INTERVAL:function(){return k},default:function(){return C}});var s=n(85893),r=n(67294),a=n(84381),l=n(99519),o=n(64777),i=n(55709),c=n(69677),d=n(93626),u=n(68795),m=n(45938),h=n(17388),x=n(37926),j=n(70241);let y=e=>{let{data:t}=e,n=[{title:"Display Name",key:"username",render(e){let{user:t,connectedAt:n,messageCount:r,userAgent:a}=e;return(0,s.jsx)(h.Z,{user:t,connectionInfo:{connectedAt:n,messageCount:r,userAgent:a},children:(0,s.jsx)("span",{className:"display-name",children:t.displayName})})},sorter:(e,t)=>t.user.displayName.localeCompare(e.user.displayName),filterIcon:(0,s.jsx)(u.Z,{}),filterDropdown(e){let{setSelectedKeys:t,selectedKeys:n,confirm:r}=e;return(0,s.jsx)("div",{style:{padding:8},children:(0,s.jsx)(c.Z,{placeholder:"Search display names...",value:n[0],onChange(e){t(e.target.value?[e.target.value]:[]),r({closeDropdown:!1})}})})},onFilter:(e,t)=>t.user.displayName.includes(e),sortDirections:["descend","ascend"]},{title:"Messages sent",dataIndex:"messageCount",key:"messageCount",className:"number-col",width:"12%",sorter:(e,t)=>e.messageCount-t.messageCount,sortDirections:["descend","ascend"],render:e=>(0,s.jsx)("div",{style:{textAlign:"center"},children:e})},{title:"Connected Time",dataIndex:"connectedAt",key:"connectedAt",defaultSortOrder:"ascend",render:e=>(0,m.Z)(new Date(e)),sorter:(e,t)=>new Date(t.connectedAt).getTime()-new Date(e.connectedAt).getTime(),sortDirections:["descend","ascend"]},{title:"User Agent",dataIndex:"userAgent",key:"userAgent",render:e=>(0,j.AB)(e)},{title:"Location",dataIndex:"geo",key:"geo",render:e=>e?"".concat(e.regionName,", ").concat(e.countryCode):"-"},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,s.jsx)(x.e,{user:t.user,isEnabled:!t.user.disabledAt})}];return(0,s.jsx)(d.Z,{className:"table-container",pagination:{hideOnSinglePage:!0},columns:n,dataSource:t,size:"small",rowKey:"id"})};var g=n(71577),p=n(58091),f=n(84674);async function b(e){try{await (0,o.rQ)(o.RB,{data:{value:e},method:"POST",auth:!0})}catch(t){console.error(t)}}let w=e=>{let{data:t}=e;return(0,s.jsx)(d.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:[{title:"IP Address",dataIndex:"ipAddress",key:"ipAddress"},{title:"Reason",dataIndex:"notes",key:"notes"},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>(0,p.Z)(new Date(e),"MMM d H:mma"),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,s.jsx)(g.Z,{title:"Remove IP Address Ban",onClick:()=>b(t.ipAddress),icon:(0,s.jsx)(f.Z,{twoToneColor:"#ff4d4f"}),className:"block-user-button"})}],dataSource:t,size:"large",rowKey:"ipAddress"})},k=1e4;function C(){let e=(0,r.useContext)(l.aC),{online:t}=e||{},[n,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[m,h]=(0,r.useState)([]),[x,j]=(0,r.useState)([]),g=async()=>{try{let e=await (0,o.rQ)(o.qk);c(e)}catch(t){console.log("==== error",t)}try{let n=await (0,o.rQ)(o.Kp);h(n)}catch(s){console.log("==== error",s)}try{let r=await (0,o.rQ)(o.GC);j(r)}catch(a){console.error("error fetching moderators",a)}try{let l=await (0,o.rQ)(o.Bu);u(l)}catch(i){console.error("error fetching banned ips",i)}};(0,r.useEffect)(()=>{let e=null;return g(),e=setInterval(g,k),()=>{clearInterval(e)}},[t]);let p=t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y,{data:m}),(0,s.jsxs)("p",{className:"description",children:["Visit the"," ",(0,s.jsx)("a",{href:"https://owncast.online/docs/viewers/?source=admin",target:"_blank",rel:"noopener noreferrer",children:"documentation"})," ","to configure additional details about your viewers."]})]}):(0,s.jsx)("p",{className:"description",children:"When a stream is active and chat is enabled, connected chat clients will be displayed here."}),f=(0,s.jsxs)("span",{children:["Connected ",t?"(".concat(m.length,")"):"(offline)"]}),b=(0,s.jsxs)("span",{children:["Banned Users (",n.length,")"]}),C=(0,s.jsx)(i.K,{data:n}),N=(0,s.jsxs)("span",{children:["IP Bans (",d.length,")"]}),A=(0,s.jsx)(w,{data:d}),Z=(0,s.jsxs)("span",{children:["Moderators (",x.length,")"]}),v=(0,s.jsx)(i.K,{data:x});return(0,s.jsx)(a.Z,{defaultActiveKey:"1",items:[{label:f,key:"1",children:p},{label:b,key:"2",children:C},{label:N,key:"3",children:A},{label:Z,key:"4",children:v}]})}}},function(e){e.O(0,[3662,8939,3903,4267,3626,8091,4381,5938,7635,9774,2888,179],function(){return e(e.s=55583)}),_N_E=e.O()}]);