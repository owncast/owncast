(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6109],{92794:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/viewer-info",function(){return r(6965)}])},57565:function(e,t,r){"use strict";r.d(t,{k:function(){return d}});var n=r(85893),a=r(36627),s=r(67294),i=r(80140),l=r(23148),o=r(26495),u=r(51095);function c(e){let t={};return e.forEach(e=>{let r=new Date(e.time);t[(0,a.WU)(r,"H:mma")]=e.value}),t}l.kL.register(l.uw,l.WV,l.f$,l.od,l.jn,l.Dx,l.u,l.De);let d=e=>{let{data:t,title:r,color:a,unit:l,dataCollections:d,yFlipped:f,yLogarithmic:h,minYValue:x,yStepSize:p=0}=e,m=[],g=(0,s.useRef)(null);return t&&t.length>0&&m.push({id:r,label:r,backgroundColor:a,borderColor:a,borderWidth:3,data:c(t)}),d.forEach(e=>{m.push({id:e.name,label:e.name,data:c(e.data),backgroundColor:e.color,borderColor:e.color,borderWidth:3,pointStyle:e.pointStyle||"circle",radius:e.pointRadius||1})}),(0,n.jsxs)("div",{className:"line-chart-container",children:[(0,n.jsx)(o.x1,{ref:g,data:{datasets:m},options:{responsive:!0,clip:!1,scales:{y:{type:h?"logarithmic":"linear",reverse:f,min:x,ticks:{stepSize:p},title:{display:!0,text:l}}}},height:"70vh"}),(0,n.jsx)(u.Z,{size:"small",onClick:()=>{if(g.current){let e=document.createElement("a");e.download="chart.png",e.href=g.current.canvas.toDataURL(),e.click()}},type:"ghost",icon:(0,n.jsx)(i.Z,{}),className:"download-btn"})]})};d.defaultProps={dataCollections:[],data:[],title:"",yFlipped:!1,yLogarithmic:!1}},97098:function(e,t,r){"use strict";r.d(t,{m:function(){return h}});var n=r(85893),a=r(73745),s=r(50459),i=r(23976),l=r(96361);let{Text:o}=a.default,u={title:"",value:0,prefix:null,suffix:null,color:"",progress:!1,centered:!1,formatter:null},c=e=>{let{prefix:t,value:r,suffix:a,title:s}=e;return(0,n.jsxs)("div",{children:[t,(0,n.jsx)("div",{children:(0,n.jsx)(o,{type:"secondary",children:s})}),(0,n.jsx)("div",{children:(0,n.jsxs)(o,{type:"secondary",children:[r,a||"%"]})})]})},d=e=>{let{title:t,value:r,prefix:a,suffix:i,color:l}=e,o=r>90?"red":l,u=(0,n.jsx)(c,{prefix:a,value:r,suffix:i,title:t});return(0,n.jsx)(s.Z,{type:"dashboard",percent:r,width:120,strokeColor:{"0%":l,"90%":o},format:()=>u})};d.defaultProps=u;let f=e=>{let{title:t,value:r,prefix:a,formatter:s}=e;return(0,n.jsx)(i.Z,{title:t,value:r,prefix:a,formatter:s})};f.defaultProps=u;let h=e=>{let{progress:t,centered:r}=e,a=t?d:f;return(0,n.jsx)(l.default,{type:"inner",children:(0,n.jsx)("div",{style:r?{display:"flex",alignItems:"center",justifyContent:"center"}:{},children:(0,n.jsx)(a,{...e})})})};h.defaultProps=u},8994:function(e,t,r){"use strict";var n=r(67294),a=r(13481),s=r(61210);t.Z=function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=(0,n.useRef)({}),r=(0,a.Z)();return(0,n.useEffect)(function(){var n=s.ZP.subscribe(function(n){t.current=n,e&&r()});return function(){return s.ZP.unsubscribe(n)}},[]),t.current}},6965:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var n=r(85893),a=r(67294),s=r(73745),i=r(94715),l=r(39964),o=r(68175),u=r(69361),c=r(30247),d=r(83957),f=r(13284),h=r(77113);function x(e,t){var r,n,a;let{years:s=0,months:i=0,weeks:l=0,days:o=0,hours:u=0,minutes:c=0,seconds:x=0}=t,p=(r=i+12*s,n=(0,f.z)(e,-r),a=o+7*l,(0,d.E)(n,-a));return(0,h.L)(e,p.getTime()-1e3*(x+60*(c+60*u)))}var p=r(47296),m=r(5152),g=r.n(m),j=r(57565),v=r(97098),w=r(89062),y=r(85727),b=r(53210);let k=e=>{let{data:t}=e;return(0,n.jsx)(w.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:[{title:"User Agent",dataIndex:"userAgent",key:"userAgent",render:e=>(0,b.AB)(e)},{title:"Location",dataIndex:"geo",key:"geo",render:e=>e?"".concat(e.regionName,", ").concat(e.countryCode):"-"},{title:"Watch Time",dataIndex:"firstSeen",key:"firstSeen",defaultSortOrder:"ascend",render:e=>(0,y.Q)(new Date(e)),sorter:(e,t)=>new Date(e.firstSeen).getTime()-new Date(t.firstSeen).getTime(),sortDirections:["descend","ascend"]}],dataSource:t,size:"small",rowKey:"id"})};var S=r(34333),D=r(27478),N=r(27674);let Z=g()(()=>Promise.all([r.e(3908),r.e(874)]).then(r.t.bind(r,70874,23)),{loadableGenerated:{webpack:()=>[70874]},ssr:!1}),C=g()(()=>Promise.all([r.e(3908),r.e(6037)]).then(r.t.bind(r,66037,23)),{loadableGenerated:{webpack:()=>[66037]},ssr:!1});function L(){let e;let{online:t,broadcaster:r,viewerCount:d,overallPeakViewerCount:f,sessionPeakViewerCount:h}=(0,a.useContext)(S.a)||{};r&&r.time&&(e=new Date(r.time));let m=[{title:"Current stream",start:e},{title:"Last 12 hours",start:x(new Date,{hours:12})},{title:"Last 24 hours",start:x(new Date,{hours:24})},{title:"Last 7 days",start:x(new Date,{days:7})},{title:"Last 30 days",start:x(new Date,{days:30})},{title:"Last 3 months",start:x(new Date,{months:3})},{title:"Last 6 months",start:x(new Date,{months:6})}],[g,w]=(0,a.useState)(!0),[y,b]=(0,a.useState)([]),[N,L]=(0,a.useState)([]),[E,_]=(0,a.useState)(m[1]),P=async()=>{try{var e;let t="".concat(D.iV,"?windowStart=").concat((e=E.start,Math.trunc(+(0,p.Q)(e)/1e3))),r=await (0,D.rQ)(t);b(r),w(!1)}catch(e){console.log("==== error",e)}try{let e=await (0,D.rQ)(D.a_);L(e)}catch(e){console.log("==== error",e)}};(0,a.useEffect)(()=>{let e=null;return(P(),t)?(e=setInterval(P,6e4),()=>{clearInterval(e)}):()=>[]},[t,E]);let T=e=>{let{key:t}=e;_(m[t])},I=t&&e?0:1,z=m.slice(I).map((e,t)=>({key:t+I,label:e.title,onClick:T}));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.default.Title,{children:"Viewer Info"}),(0,n.jsx)("br",{}),(0,n.jsxs)(i.Z,{gutter:[16,16],justify:"space-around",children:[t&&(0,n.jsx)(l.Z,{span:8,md:8,children:(0,n.jsx)(v.m,{title:"Current viewers",value:d.toString(),prefix:(0,n.jsx)(C,{})})}),(0,n.jsx)(l.Z,{md:t?8:12,children:(0,n.jsx)(v.m,{title:t?"Max viewers this stream":"Max viewers last stream",value:h.toString(),prefix:(0,n.jsx)(C,{})})}),(0,n.jsx)(l.Z,{md:t?8:12,children:(0,n.jsx)(v.m,{title:"All-time max viewers",value:f.toString(),prefix:(0,n.jsx)(C,{})})})]}),!y.length&&(0,n.jsx)(o.Z,{style:{marginTop:"10px"},banner:!0,message:"Please wait",description:"No viewer data has been collected yet.",type:"info"}),(0,n.jsxs)(u.Z,{spinning:!y.length||g,children:[y.length>0&&(0,n.jsx)(j.k,{title:"Viewers",data:y,color:"#2087E2",unit:"viewers",minYValue:0,yStepSize:1}),(0,n.jsx)(c.Z,{menu:{items:z},trigger:["click"],children:(0,n.jsxs)("button",{type:"button",style:{position:"absolute",top:"5px",right:"35px",background:"transparent",border:"unset"},children:[E.title," ",(0,n.jsx)(Z,{})]})}),(0,n.jsx)(k,{data:N})]})]})}L.getLayout=function(e){return(0,n.jsx)(N.l,{page:e})}},83957:function(e,t,r){"use strict";r.d(t,{E:function(){return s}});var n=r(47296),a=r(77113);function s(e,t){let r=(0,n.Q)(e);return isNaN(t)?(0,a.L)(e,NaN):(t&&r.setDate(r.getDate()+t),r)}},13284:function(e,t,r){"use strict";r.d(t,{z:function(){return s}});var n=r(47296),a=r(77113);function s(e,t){let r=(0,n.Q)(e);if(isNaN(t))return(0,a.L)(e,NaN);if(!t)return r;let s=r.getDate(),i=(0,a.L)(e,r.getTime());return(i.setMonth(r.getMonth()+t+1,0),s>=i.getDate())?i:(r.setFullYear(i.getFullYear(),i.getMonth(),s),r)}}},function(e){e.O(0,[2196,2016,4992,9831,6113,9505,4970,3745,6919,6880,6655,8810,247,9062,3109,3243,6627,5727,6956,7573,548,7674,2888,9774,179],function(){return e(e.s=92794)}),_N_E=e.O()}]);