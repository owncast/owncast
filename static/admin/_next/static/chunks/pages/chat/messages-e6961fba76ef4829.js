(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[145],{9007:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/messages",function(){return n(40625)}])},40625:function(e,t,n){"use strict";n.r(t),n.d(t,{OUTCOME_TIMEOUT:function(){return _},default:function(){return E}});var r=n(35666),s=n.n(r),i=n(85893),a=n(67294),o=n(17256),c=n(71577),u=n(44206),l=n(89739),d=n(21640),f=n(94184),m=n.n(f),h=n(58091),p=n(58827),v=n(2766),g=n(56266),y=n(99611),b=n(90420);function w(e,t,n,r,s,i,a){try{var o=e[i](a),c=o.value}catch(u){return void n(u)}o.done?t(c):Promise.resolve(c).then(r,s)}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}function O(e){var t=e.isVisible,n=e.message,r=e.setMessage;if(!n||(0,v.Qr)(n))return null;var o=null,u=(0,a.useState)(0),f=u[0],m=u[1],h=(n||{}).id;(0,a.useEffect)((function(){return function(){clearTimeout(o)}}));var x,O=(x=s().mark((function e(){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(o),m(0),e.next=4,(0,p.rQ)(p.hn,{auth:!0,method:"POST",data:{visible:!t,idArray:[h]}});case 4:(i=e.sent).success&&"changed"===i.message?(r(j({},n,{visible:!t})),m(1)):(r(j({},n,{visible:t})),m(-1)),o=setTimeout((function(){m(0)}),_);case 7:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var s=x.apply(e,t);function i(e){w(s,n,r,i,a,"next",e)}function a(e){w(s,n,r,i,a,"throw",e)}i(void 0)}))}),N=(0,i.jsx)(l.Z,{style:{color:"transparent"}});f&&(N=f>0?(0,i.jsx)(l.Z,{style:{color:"var(--ant-success)"}}):(0,i.jsx)(d.Z,{style:{color:"var(--ant-warning)"}}));var S="Click to ".concat(t?"hide":"show"," this message");return(0,i.jsxs)("div",{className:"toggle-switch ".concat(t?"":"hidden"),children:[(0,i.jsx)("span",{className:"outcome-icon",children:N}),(0,i.jsx)(g.Z,{title:S,placement:"topRight",children:(0,i.jsx)(c.Z,{shape:"circle",size:"small",type:"text",icon:t?(0,i.jsx)(y.Z,{}):(0,i.jsx)(b.Z,{}),onClick:O})})]})}var N=n(85584);function S(e,t,n,r,s,i,a){try{var o=e[i](a),c=o.value}catch(u){return void n(u)}o.done?t(c):Promise.resolve(c).then(r,s)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var i=e.apply(t,n);function a(e){S(i,r,s,a,o,"next",e)}function o(e){S(i,r,s,a,o,"throw",e)}a(void 0)}))}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}function C(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Z=o.Z.Title;var _=3e3;function E(){var e=(0,a.useState)([]),t=e[0],n=e[1],r=(0,a.useState)([]),o=r[0],f=r[1],g=(0,a.useState)(!1),y=g[0],b=g[1],w=(0,a.useState)(null),x=w[0],j=w[1],S=(0,a.useState)(""),P=S[0],E=S[1],A=null,I=null,M=k(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,p.rQ)(p.WE,{auth:!0});case 3:t=e.sent,(0,v.Qr)(t)?n([]):n(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("==== error",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));(0,a.useEffect)((function(){return M(),I=setInterval((function(){M()}),p.NE),function(){clearTimeout(A),clearTimeout(I)}}),[]);var z=function(e){return e.reduce((function(e,t){var n=t.user.id;return e.some((function(e){return e.text===n}))||e.push({text:n,value:n}),e}),[]).sort((function(e,t){var n=e.text.toUpperCase(),r=t.text.toUpperCase();return n<r?-1:n>r?1:0}))}(t),D={selectedRowKeys:o,onChange:function(e){f(e)}},Q=function(e){var r=t.findIndex((function(t){return t.id===e.id}));t.splice(r,1,e),n(C(t))},U=function(){A=setTimeout((function(){j(null),E("")}),_)},H=k(s().mark((function e(r){var a,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.next=3,(0,p.rQ)(p.hn,{auth:!0,method:"POST",data:{visible:r,idArray:o}});case 3:(a=e.sent).success&&"changed"===a.message?(j((0,i.jsx)(l.Z,{})),U(),c=C(t),o.map((function(e){var n=c.findIndex((function(t){return t.id===e})),s=T({},t[n],{visible:r});return c.splice(n,1,s),null})),n(c),f([])):(j((0,i.jsx)(d.Z,{})),U()),b(!1);case 6:case"end":return e.stop()}}),e)}))),V=[{title:"Time",dataIndex:"timestamp",key:"timestamp",className:"timestamp-col",defaultSortOrder:"descend",render:function(e){var t=new Date(e);return(0,h.Z)(t,"PP pp")},sorter:function(e,t){return new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()},width:90},{title:"User",dataIndex:"user",key:"user",className:"name-col",filters:z,onFilter:function(e,t){return t.user.id===e},sorter:function(e,t){return e.user.displayName.localeCompare(t.user.displayName)},sortDirections:["ascend","descend"],ellipsis:!0,render:function(e){var t=e.displayName;return(0,i.jsx)(N.Z,{user:e,children:t})},width:110},{title:"Message",dataIndex:"body",key:"body",className:"message-col",width:320,render:function(e){return(0,i.jsx)("div",{className:"message-contents",dangerouslySetInnerHTML:{__html:e}})}},{title:"",dataIndex:"hiddenAt",key:"hiddenAt",className:"toggle-col",filters:[{text:"Visible messages",value:!0},{text:"Hidden messages",value:!1}],onFilter:function(e,t){return t.visible===e},render:function(e,t){return(0,i.jsx)(O,{isVisible:!e,message:t,setMessage:Q})},width:30}],F=m()({"bulk-editor":!0,active:o.length});return(0,i.jsxs)("div",{className:"chat-messages",children:[(0,i.jsx)(Z,{children:"Chat Messages"}),(0,i.jsx)("p",{children:"Manage the messages from viewers that show up on your stream."}),(0,i.jsxs)("div",{className:F,children:[(0,i.jsx)("span",{className:"label",children:"Check multiple messages to change their visibility to: "}),(0,i.jsx)(c.Z,{type:"primary",size:"small",shape:"round",className:"button",loading:"show"===P&&y,icon:"show"===P&&x,disabled:!o.length||P&&"show"!==P,onClick:function(){E("show"),H(!0)},children:"Show"}),(0,i.jsx)(c.Z,{type:"primary",size:"small",shape:"round",className:"button",loading:"hide"===P&&y,icon:"hide"===P&&x,disabled:!o.length||P&&"hide"!==P,onClick:function(){E("hide"),H(!1)},children:"Hide"})]}),(0,i.jsx)(u.Z,{size:"small",className:"table-container",pagination:{defaultPageSize:100,showSizeChanger:!0},scroll:{y:540},rowClassName:function(e){return e.hiddenAt?"hidden":""},dataSource:t,columns:V,rowKey:function(e){return e.id},rowSelection:D})]})}}},function(e){e.O(0,[662,206,697,91,533,371,774,888,179],(function(){return t=9007,e(e.s=t);var t}));var t=e.O();_N_E=t}]);